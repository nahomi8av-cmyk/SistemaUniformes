{% extends "base.html" %}

{% block title %}Editar Sesión #{{ sesion.idCaja }}{% endblock %}

{% block content %}
    <h1 style="color: #6C5CE7; margin-bottom: 20px;">
        Editar Sesión de Caja #{{ sesion.idCaja }}
    </h1>
    
    {% if error %}
        <div style="padding: 10px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; margin-bottom: 20px; border-radius: 4px;">
            {{ error }}
        </div>
    {% endif %}

    <form method="post" style="max-width: 500px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #fff;">
        {% csrf_token %}

        <h3 style="margin-top: 0; color: #343a40;">Información de la Sesión</h3>

        {# CORRECCIÓN: Empleado Apertura usa 'abierto_por' #}
        <p><strong>Empleado Apertura:</strong> {{ sesion.abierto_por.nombre|default:"N/A" }}</p>

        {# CORRECCIÓN: Fecha de Apertura usa 'abierto_en' #}
        <p><strong>Fecha de Apertura:</strong> {{ sesion.abierto_en|date:"Y-m-d H:i" }}</p>

        <!-- Campo Fondo Inicial (Se puede editar) -->
        {# CORRECCIÓN: El nombre del input debe ser 'fondo_inicial' #}
        <label for="id_fondo_inicial" style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold;">Fondo Inicial ($):</label>
        <input type="number" step="0.01" min="0" id="id_fondo_inicial" name="fondo_inicial" value="{{ sesion.fondo_inicial|floatformat:2 }}" required
               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;">


        <!-- Detalles de Cierre (Sólo lectura si existen) -->
        {# CORRECCIÓN: La verificación de cierre usa 'cerrado_en' #}
        {% if sesion.cerrado_en %}
            <h4 style="margin-top: 20px; color: #3498db;">Detalles de Cierre (No Editables)</h4>

            {# CORRECCIÓN: Fecha de Cierre usa 'cerrado_en' #}
            <p><strong>Fecha de Cierre:</strong> {{ sesion.cerrado_en|date:"Y-m-d H:i" }}</p>

            {# CORRECCIÓN: Efectivo de Cierre usa 'conteo_final' (según la lista de campos) #}
            <p><strong>Efectivo de Cierre:</strong> ${{ sesion.conteo_final|floatformat:2 }}</p>

            {# CORRECCIÓN: Empleado Cierre usa 'cerrado_por' #}
            <p><strong>Empleado Cierre:</strong> {{ sesion.cerrado_por.nombre|default:"N/A" }}</p>
        {% endif %}

        <button type="submit" style="margin-top: 25px; padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
            Guardar Cambios
        </button>
        <a href="{% url 'listar_sesiones' %}" style="display: inline-block; margin-left: 10px; margin-top: 25px; color: #6c757d; text-decoration: none; padding: 10px 15px; border: 1px solid #ccc; border-radius: 4px;">
            Cancelar
        </a>
    </form>
{% endblock %}