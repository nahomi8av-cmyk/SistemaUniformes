{% extends "base.html" %}
{% block content %}

    <h2>üí∏ Movimientos de Caja</h2>
    <hr>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li style="list-style: none; padding: 10px; margin-bottom: 10px; border-radius: 5px;
                    {% if message.tags == 'success' %}background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                    {% elif message.tags == 'error' %}background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                    {% elif message.tags == 'warning' %}background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;
                    {% endif %}">
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <p style="margin-bottom: 15px; font-weight: bold; color: #007bff;">
        Caja Activa: #{{ caja.idCaja }} |
        Abierta por: {{ caja.abierto_por.nombre }} |
        Fondo Inicial: ${{ caja.fondo_inicial|floatformat:2 }}
    </p>

    <a href="{% url 'agregar_movimiento' %}"
       style="text-decoration: none; padding: 10px 20px; display: inline-block; background-color: #28a745; color: white; text-align: center; border-radius: 5px; margin-bottom: 20px;">
       ‚ûï Registrar Nuevo Movimiento (Entrada/Salida)
    </a>

    {% if movimientos %}
        <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 12px; width: 15%;">Fecha</th>
                    <th style="padding: 12px; width: 10%;">Tipo</th>
                    <th style="padding: 12px; width: 15%; text-align: right;">Monto</th>
                    <th style="padding: 12px; width: 40%; text-align: left;">Descripci√≥n</th>
                    <th style="padding: 12px; width: 10%;">Registrado Por</th>
                    <th style="padding: 12px; width: 10%;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in movimientos %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px; text-align: center;">{{ mov.fecha|date:"Y-m-d H:i" }}</td>
                    <td style="padding: 10px; text-align: center; font-weight: bold; color: {% if mov.tipo == 'ENTRADA' %}#28a745{% else %}#dc3545{% endif %};">
                        {{ mov.tipo }}
                    </td>
                    <td style="padding: 10px; text-align: right;">${{ mov.monto|floatformat:2 }}</td>
                    <td style="padding: 10px; text-align: left;">{{ mov.descripcion }}</td>
                    <td style="padding: 10px; text-align: center;">{{ mov.creado_por.nombre }}</td>
                    <td style="padding: 10px; text-align: center;">
                        <a href="{% url 'editar_movimiento' movimiento_id=mov.idMovimiento %}"
                           title="Editar Movimiento"
                           style="color: #ffc107; margin-right: 10px; text-decoration: none;">‚úèÔ∏è</a>
                        <a href="{% url 'borrar_movimiento' movimiento_id=mov.idMovimiento %}"
                           title="Borrar Movimiento"
                           style="color: #dc3545; text-decoration: none;">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p style="margin-top: 20px; color: #6c757d;">No se han registrado movimientos de caja en esta sesi√≥n.</p>
    {% endif %}

{% endblock %}