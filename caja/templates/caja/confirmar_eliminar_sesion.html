{% extends "base.html" %}

{% block title %}Confirmar Eliminación de Sesión de Caja{% endblock %}

{% block content %}
    <h1 style="color: #dc3545; margin-bottom: 20px;">
        ⚠️ Confirmar Eliminación de Sesión
    </h1>
    
    <div style="max-width: 500px; padding: 25px; border: 2px solid #dc3545; border-radius: 8px; background-color: #f8d7da;">
        <p style="font-size: 1.2em; font-weight: bold; color: #721c24;">
            ¿Está seguro que desea eliminar la Sesión de Caja #{{ sesion.idCaja }}?
        </p>
        <p style="color: #721c24;">
            Esta acción es irreversible. Solo debe hacerse si la sesión está abierta y no ha registrado movimientos importantes.
        </p>
        
        {# CORRECCIÓN: La verificación de cierre usa 'cerrado_en' #}
        {% if sesion.cerrado_en %}
            <p style="color: #dc3545; font-weight: bold;">
                ADVERTENCIA: Esta sesión ya fue cerrada el {{ sesion.cerrado_en|date:"Y-m-d H:i" }}. Eliminarla podría causar inconsistencias.
            </p>
        {% endif %}

        <ul style="list-style-type: none; padding: 0; margin-top: 15px;">
            <li><strong>Caja:</strong> {{ sesion.idCaja.nombre_caja }}</li>

            {# CORRECCIÓN: Apertura por usa 'abierto_por' #}
            <li><strong>Apertura por:</strong> {{ sesion.abierto_por.nombre|default:"N/A" }}</li>

            {# CORRECCIÓN: Fecha de Apertura usa 'abierto_en' #}
            <li><strong>Fecha de Apertura:</strong> {{ sesion.abierto_en|date:"Y-m-d H:i" }}</li>
        </ul>

        <form method="post" action="{% url 'eliminar_sesion' sesion.idCaja %}" style="margin-top: 25px;">
            {% csrf_token %}
            <button type="submit" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                Sí, Eliminar Permanentemente
            </button>
            <a href="{% url 'listar_sesiones' %}" style="margin-left: 15px; padding: 10px 20px; background-color: #6c757d; color: white; border-radius: 4px; text-decoration: none;">
                Cancelar
            </a>
        </form>
        
        {% if error %}
            <p style="color: #721c24; margin-top: 15px;">** ERROR: {{ error }}</p>
        {% endif %}
    </div>
{% endblock %}