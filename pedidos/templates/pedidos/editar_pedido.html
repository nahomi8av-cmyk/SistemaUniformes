{% extends "base.html" %}

{% block title %}Editar Pedido #{{ pedido.idPedido }}{% endblock %}

{% block content %}
    <h1 style="color: #007bff; margin-bottom: 20px;">
        Editar Pedido #{{ pedido.idPedido }}
    </h1>

    {% if error %}
        <div style="padding: 10px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; margin-bottom: 20px; border-radius: 4px;">
            {{ error }}
        </div>
    {% endif %}

    <form method="post" style="max-width: 500px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #fff;">
        {% csrf_token %}

        <h3 style="margin-top: 0; color: #343a40;">Información del Pedido</h3>
        <!-- Mostrar datos de solo lectura, accediendo a las relaciones (ForeignKey) -->
        <p><strong>Cliente:</strong> {{ pedido.idCliente.nombre }}</p>
        <p><strong>Creado Por:</strong> {{ pedido.creado_por.nombre }}</p>
        <p><strong>Fecha de Creación:</strong> {{ pedido.fecha|date:"Y-m-d H:i" }}</p>

        <!-- Campo Total -->
        <label for="id_total" style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold;">Total ($):</label>
        <input type="number" step="0.01" min="0" id="id_total" name="total" value="{{ pedido.total|floatformat:2 }}" required
               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;">

        <!-- Campo Abono -->
        <label for="id_abono" style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold;">Abono ($):</label>
        <input type="number" step="0.01" min="0" id="id_abono" name="abono" value="{{ pedido.abono_acumulado|floatformat:2 }}" required
               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;">

        <!-- Campo Estado (Usando los choices del modelo Pedido.ESTADOS) -->
        <label for="id_estado" style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold;">Estado:</label>
        <select id="id_estado" name="estado" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;">
            {% for key, value in estados %}
                <option value="{{ key }}" {% if pedido.estado == key %}selected{% endif %}>{{ value }}</option>
            {% endfor %}
        </select>

        <!-- Campo Notas -->
        <label for="id_notas" style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold;">Notas:</label>
        <textarea id="id_notas" name="notas" rows="3" maxlength="200"
                  style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;">{{ pedido.notas|default:"" }}</textarea>

        <button type="submit" style="margin-top: 25px; padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
            Guardar Cambios
        </button>
        <a href="{% url 'pedidos:listar_pedidos' %}" style="display: inline-block; margin-left: 10px; margin-top: 25px; color: #6c757d; text-decoration: none; padding: 10px 15px; border: 1px solid #ccc; border-radius: 4px;">
            Cancelar
        </a>
    </form>
{% endblock %}